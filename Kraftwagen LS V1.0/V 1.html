<!DOCTYPE HTML>
<html>
  <head>
    <style>

    *{
      padding: 0;
      margin: 0 ;
      overflow: hidden;
    }
    canvas {
      display: inline;
      position: absolute;
    }
    #myCanvas {

    }
    #mini{
      bottom: 0;
      right: 0;
      z-index: 0;
    }
    p{
      display: inline;
      /*position: absolute;
      right: 0;
      bottom: 50%;
      z-index: 0;*/
    }

    </style>
  </head>
  <body>
  <p id="disp"></p>
  <p id="play"></p>
    <canvas id="myCanvas" ></canvas>
    <canvas id="mini"></canvas> 
    <img src="Car.png" style="display: none;" id="car">
    <img src="City.png" style="display: none;" id="city">
    <img src="Beach Final.png" style="display: none;" id="beach">
    <img src="Fissure.png" style="display: none;" id="fissure">
    <script>
      window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 60);
        };
      })();


/*--------------------------------------------------Drawing functions-------------------------------------------------------------------------*/

      function path(){
        context.beginPath();
        context.rect(window.innerWidth/3, road.y, window.innerWidth/3,window.innerHeight);
        context.fillStyle = '#22313F';
        context.fill();


      }
     function sidelanes(){
      context.beginPath();
      context.rect(window.innerWidth/3+window.innerWidth/100, road.y, window.innerWidth/100, window.innerHeight);
      context.rect(window.innerWidth*194/300, road.y, window.innerWidth/100, window.innerHeight);
      context.fillStyle = "#F5AB35";
      context.fill();
     }
      function drawRectangle(one, two, three, context) {              
        context.beginPath();
        context.rect(one.x, one.y, one.width, one.height);
       
        context.rect(two.x, two.y, two.width, two.height);
        
        context.rect(three.x, three.y, three.width, three.height);
        
       
        
        context.fillStyle = '#E4F1FE';
        context.fill();
       
      }
      function drawCar() {
         context.drawImage(img, car.x, car.y, window.innerWidth/3, window.innerHeight);
         
      }
      var count = 0;
      var countTwo = 0;
      setInterval(function(){
        
        if (!pause) {
          count +=1;
          if (index >= 200) {
        countTwo +=1;
       }
        }
       

        }, 1);
       
      function beachBackground() {
        context.drawImage(beachImg, 0, road.backY, window.innerWidth/3, window.innerHeight*3);
        //context.drawImage(beachImg, 0, road.backY - window.innerHeight*2, window.innerWidth/3, window.innerHeight*2);
      }
      function cityBackground() {
        context.drawImage(cityImg, window.innerWidth*2/3, road.backY, window.innerWidth/3, window.innerHeight*3);
      }
      function obstacleFissure(){
        context.drawImage(fisImg, obstacle.fissureX, obstacle.fissureY, obstacle.fissureW, obstacle.fissureW*fisImg.height/fisImg.width);
      }
      
/*----------------------------------------------------------Animate------------------------------------------------------------------------*/
      function animate(one, two, three, context, startTime, speed) {
        
        if (index <= 200) {
        var time = (new Date()).getTime() - startTime;
        
       
        if (car.x < window.innerWidth / 4.5) {
          car.x = window.innerWidth/4.5;
        }
        if (car.x > window.innerWidth / 2.25) {
          car.x = window.innerWidth / 2.25;
        }
        // pixels / second
      
        
         if (pause) {
          last = (new Date()).getTime();
        }
        dx = dt*speed/maxSpeed*300;
        if (!pause) {
        now =  (new Date()).getTime();
        dt  = Math.min(1, (now - last) / 1000);
        last = now;
        newY = newY + speed*dt;
        
      }
        nextY = speed*countTwo/100;
        if (speed == 600) {
      nitroTime = nitroTime + 1*dt;
        }
        
        

        if(upspeed) {
          pause = false;
          if (speed < maxSpeed) {
            speed = speed + acceleration*at/100;
          }
          
         
        }

        if(downspeed) {
            if (speed >= 0 ) {
              speed = speed + decel*at/100;
            }
            if (speed <0) {
              speed = 0;
            }
            //pause = true;
           
        }
        if (right) {
          if (speed > 0 && !pause) {
          if (car.x <= window.innerWidth/2.25 && car.x >= window.innerWidth/4.5 ) {
          car.x = car.x + dx;
        }
        }
        }
        if (left) {
          if (speed > 0 && !pause) {
          if (car.x <= window.innerWidth/2.25 && car.x >= window.innerWidth/4.5 ) {
          car.x = car.x - dx;
        }
        }
      }
      if (nitro ) {

        speed = 600;

      
    }
    if (speed != 600) {
      prevSpeed = speed;
    }
    if (nitroTime >= 5) {
          nitroTime = 0;
          speed = prevSpeed;
        }

      
        road.y = nextY;
        one.y = newY - index*window.innerHeight*2/5;
        two.y = one.y + window.innerHeight*2/5;
        three.y = one.y +window.innerHeight*4/5;
        road.backY = newY - window.innerHeight*2*(indexTwo);
        road.cityY = newY - window.innerHeight*3*(indexThree);
        if (three.y >= window.innerHeight) {
          index ++;
        }
        if (road.backY >= 0) {
          indexTwo = indexTwo + 1;
        }
        if (road.cityY >= 0) {
          indexThree = indexThree + 1;
        }
        if(index >=200) {
          index = 200;
          one.y = -window.innerHeight;
        }
        
        
        
        //document.getElementById('disp').innerHTML = fisImg.height;
        //document.getElementById("disp").innerHTML = nitro;
        // clear
        context.clearRect(0, 0, canvas.width, canvas.height);
        path();
        drawRectangle(one, two, three, context);
        sidelanes();
        drawCar();
        beachBackground();
        cityBackground();
        obstacleFissure();
        // request new frame
        requestAnimFrame(function() {
          animate(one, two, three, context, startTime, speed);
        });
     
      }
    }

/*------------------------------------------------------------Variables------------------------------------------------------------------------*/
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');
      context.canvas.width  = window.innerWidth;
      context.canvas.height = window.innerHeight;


      

      var one = {
        x: window.innerWidth/2,
        y: 0,
        xTwo: window.innerWidth*4/9,

        width: window.innerWidth/100,
        height: window.innerHeight/5
      };
      var two = {
        x: window.innerWidth/2,
        y: one.y + window.innerHeight*2/5,
        xTwo: window.innerWidth*4/9,

        width: window.innerWidth/100,
        height: window.innerHeight/5
      };
      var three = {
        x: window.innerWidth/2,
        y: one.y + window.innerHeight*4/5,
        xTwo: window.innerWidth*4/9,

        width: window.innerWidth/100,
        height: window.innerHeight/5
      };
      var road = {
        y: 0,
        backY: -window.innerHeight*2,
        //cityY: -window.innerHeight*2
      };
      var car = {
        x:window.innerWidth/2.25,
        y:window.innerHeight/4
      };
      var obstacle = {
        fissureX: window.innerWidth*41/75,
        fissureY: 0,
        fissureW: window.innerWidth/10

      };
      
      path();
      drawRectangle(one, two, three, context);
      sidelanes();

      var KEY = {
         LEFT:  37,
         UP:    38,
         RIGHT: 39,
         DOWN:  40,
         SPACE: 32
      };
      var nitroTime = 0;
      var speed = 100;
      var maxSpeed = 450;
      var prevSpeed = speed;
      var acceleration = 50;
      var decel = -50;
      var at = 0;
      var dt = 0;
      var dx = 0;
      var keyStartTime;
      var index = 0;
      var indexTwo = 1;
      var indexThree = 1;
      var startTime;
      var upspeed;
      var downspeed;
      var left;
      var right;
      var nitro;
      var now;
      var last;
      var newY = 0;
      var speedtwo = 0;
      var pause = true;
      var nextY = 0;
      var img = document.getElementById("car");
      
      var beachImg = document.getElementById('beach');
      var cityImg = document.getElementById('city');
      var fisImg = document.getElementById('fissure');
/*--------------------------------------------------------------------Controls---------------------------------------------------------------*/
    window.addEventListener('keydown', function(event) {
      if (event.keyCode == 37) {
        left = true;
      }
      if (event.keyCode == 38) {

        upspeed = true;
        at = at +10;
        
      }
      if (event.keyCode == 39) {
        right = true;
      }
      if (event.keyCode == 40) {
        downspeed = true;
        at = at +10;
      }
      if (event.keyCode == 32) {
        nitro = true;
        
        
      }
      
      
    });
    window.addEventListener('keyup', function(event) {
      if (event.keyCode == 37) {
        left = false;
      }
      if (event.keyCode == 38) {
        upspeed = false;

      }
      if (event.keyCode == 39) {
        right = false;
      }
      if (event.keyCode == 40) {
        downspeed = false;
      }
      if (event.keyCode == 32) {
        nitro = false;
      }
      at = 0;
      
     
      
    });

/*-----------------------------------------------------Minimap--------------------------------------------------------------------------------*/    
   

    var c = document.getElementById("mini");
    var ctx = c.getContext('2d');
    ctx.canvas.width  = window.innerWidth/5;
    ctx.canvas.height = window.innerWidth/5;
    var centerX = c.width / 2;
    var centerY = c.height / 2;
    var radius = c.width / 2 - 5;

      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
      ctx.fillStyle = '';
      ctx.fill();
      ctx.lineWidth = 5;
      ctx.strokeStyle = '#BF55EC';
      ctx.stroke();
      setTimeout(function() {
        last =  (new Date()).getTime();
        startTime = (new Date()).getTime();
        animate(one, two, three, context, startTime,speed);

      }, 1);
    </script>
  </body>
</html>      