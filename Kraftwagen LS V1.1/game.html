<!DOCTYPE HTML>
<html>
  <head>
    <style>

    *{
      padding: 0;
      margin: 0 ;
      overflow: hidden;
    }
    canvas {
      display: inline;
      position: absolute;
    }
    #myCanvas {

    }
    #mini{
      bottom: 0;
      right: 0;
      z-index: -1;
    }
    h2{
      display: none;
      position: absolute;
      left: 8%;
      top: 20%;
      z-index: 100;
      font-family: txt;
    }
    @font-face {
      font-family: 'digital';
      src: url('./fonts/digital.ttf');
    }
    @font-face {
      font-family: 'txt';
      src: url('./fonts/MavenPro-Regular.ttf');
    }
    input[type=text] {
      display: none;
      position: absolute;
      bottom: 10%;
      left: 8%;
      width: 78%;
      padding: 12px 20px;
      margin: 8px 0;
    /* box-sizing: border-box;*/
      font-size: 16px;
      border: none;
      font-family: txt;
    }
     


    </style>
  </head>
  <body>
  <h2 id="disp"> content </h2>
  <p id="play"></p>
    <canvas id="myCanvas" ></canvas>
    <canvas id="mini"></canvas> 
    <img src="./images/CarFinal.png" style="display: none;" id="car">
    <img src="./images/CityNew.jpg" style="display: none;" id="city">
    <img src="./images/BeachFinal.png" style="display: none;" id="beach">
    <img src="./images/Fissure.png" style="display: none;" id="fissure">
    <img src="./images/ScreenAlter.png" style="display: none; " id="popquiz">
    <img src="./images/Flagger.png" style="display: none; " id="flagger">
    <img src="./images/pothole.png" style="display: none;" id="pothole">
    <form>
      <input type="text" name="answer" placeholder="Answer : " id="answer" onsubmit="return false;" >
    </form>
    <script>
      window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 60);
        };
      })();


/*--------------------------------------------------Drawing functions-------------------------------------------------------*/

      function path(){
        context.beginPath();
        context.rect(window.innerWidth/3, road.y, window.innerWidth/3,window.innerHeight);
        context.fillStyle = '#22313F';
        context.fill();



      }
     function sidelanes(){
      context.beginPath();
      context.rect(window.innerWidth/3+window.innerWidth/100, road.y, window.innerWidth/100, window.innerHeight);
      context.rect(window.innerWidth*194/300, road.y, window.innerWidth/100, window.innerHeight);
      context.fillStyle = "#F5AB35";
      context.fill();
     }
      function drawRectangle(one, two, three, context) {              
        context.beginPath();
        context.rect(one.x, one.y, one.width, one.height);
       
        context.rect(two.x, two.y, two.width, two.height);
        
        context.rect(three.x, three.y, three.width, three.height);
        
       
        
        context.fillStyle = '#E4F1FE';
        context.fill();
       
      }
      function drawCar() {
         context.drawImage(img, car.x, car.y, car.w, car.h);
         
      }
      var count = 0;
      var countTwo = 0;
      setInterval(function(){
        
        if (!pause) {
          count +=1;
          if (index >= 200) {
        countTwo +=1;
       }
        }
       

        }, 1);
       setInterval(function(){
        
        if (!pause) {
          
       number = number + 1;

        }
        }, 100);
      function beachBackground() {
        context.drawImage(beachImg, 0, road.backY, window.innerWidth/3, window.innerHeight*3);

        //context.drawImage(beachImg, 0, road.backY - window.innerHeight*2, window.innerWidth/3, window.innerHeight*2);
      }
      function cityBackground() {
        context.drawImage(cityImg, window.innerWidth*2/3, road.backY, window.innerWidth/3, window.innerHeight*3);
      }
      function obSpawn(image,w,h){
        context.drawImage(image, obstacle.fissureX, obstacle.fissureY, w, h);
        //console.log(executed);

      }
      function speedometer(speed){
        context.font='70px digital';
        context.fillStyle = '#000000';
        context.fillText(parseInt( speed/10) /*speed*/, window.innerWidth*6/6.9, window.innerHeight*1/1.75);
      }
      function quizPop(){
        context.globalAlpha = 2.0;
        context.drawImage(popquiz, window.innerWidth/20, window.innerHeight/50, popquiz.width/1.15, popquiz.height/1.15);
        context.globalAlpha = 1.0;

      }

      function drawCheckpoint(){
      context.globalAlpha = 0.95555;
      context.beginPath();
      context.rect(window.innerWidth/3, checkpoint.y , window.innerWidth/3, window.innerHeight/25);
      context.fillStyle = "#DCC6E0";
      context.fill();    
      context.globalAlpha = 1.0;
      context.closePath();
      
      context.beginPath();
      context.rect(window.innerWidth/3 + window.innerWidth* 0.9 /27, checkpoint.y , window.innerWidth/27, window.innerHeight/25);
      context.fillStyle = "#C0392B";
      context.fill();    

      context.closePath();


      context.beginPath();
      context.rect(window.innerWidth/3 + window.innerWidth*3 /27, checkpoint.y , window.innerWidth/27, window.innerHeight/25);
      context.fillStyle = "#C0392B";
      context.fill();    
      context.globalAlpha = 1.0;
      context.closePath();


      context.beginPath();
      context.rect(window.innerWidth/3 + window.innerWidth*5.2 /27, checkpoint.y , window.innerWidth/27, window.innerHeight/25);
      context.fillStyle = "#C0392B";
      context.fill();    
      context.globalAlpha = 1.0;
      context.closePath();


      context.beginPath();
      context.rect(window.innerWidth/3 + window.innerWidth*7.2 /27, checkpoint.y , window.innerWidth/27, window.innerHeight/25);
      context.fillStyle = "#C0392B";
      context.fill();    
      context.globalAlpha = 1.0;
      context.closePath();


      }
/*----------------------------------------------------Question functions----------------------------------------------------*/

      function questionDisp(){

        quizTxt.style.display = 'inline';
        quizTxt.innerHTML = question[ques];
        document.getElementById('answer').style.display = 'inline';
      }
      
        
       

/*----------------------------------------------------------Animate---------------------------------------------------------*/
      function animate(one, two, three, context, startTime, speed) {
         heights();
        if (index <= 200) {
        var time = (new Date()).getTime() - startTime;
        
       
        // pixels / second
      
        



         if (pause) {
          last = (new Date()).getTime();
        }

        if (!upspeed && !downspeed && speed!=900) {
          if (speed >0) {
          speed = speed + decel*dt;
        }
        if (speed <0) {
          speed = 0;
        }
        }  
        dx = dt*speed/maxSpeed*300;
        if (!pause) {
        now =  (new Date()).getTime();
        dt  = Math.min(1, (now - last) / 1000);
        last = now;
        newY = newY + speed*dt;
        
      }
        nextY = speed*countTwo/100;
        if (speed == 900) {
      nitroTime = nitroTime + 1*dt;
        }
        
        
      /*-----------------------------------------------Key Controls----------------------------------------------------------*/
        if(upspeed && !pause) {
         
          if (speed < maxSpeed) {
            speed = speed + acceleration*at/100;
          }
          if (speed > maxSpeed) {
            if (speed == 900) {

            } else {
            speed = maxSpeed;
          }
          }
         
        }

        if(downspeed) {
            if (speed >= 0 ) {
              speed = speed + breaking*at/100;
            }
            if (speed <0) {
              speed = 0;
            }
            //pause = true;
        
        }

        if (right) {
          
          if (speed > 0 && !pause) {
            
            if (car.x <= window.innerWidth/1.7 && car.x >= window.innerWidth/2.85 )
            {
              
              car.x = car.x + dx;
            }
            else
            {
              
            }
        }
        }
        if (left) {
          if (speed > 0 && !pause) {
          if (car.x <= window.innerWidth/1.7 && car.x >= window.innerWidth/2.85 ) {
          car.x = car.x - dx;
        }
        }
      }

      if (car.x < window.innerWidth / 2.85) {
          car.x = window.innerWidth/2.85;
        }
        if (car.x > window.innerWidth / 1.7) {
          car.x = window.innerWidth / 1.7;
        }
        

      if (nitro ) {

        speed = 900;
      }

    if (speed != 900) {
      prevSpeed = speed;
    }
    if (nitroTime >= 5) {
          nitroTime = 0;
          speed = prevSpeed;
        }

 /*-----------------------------------------------Obstacle Spawn----------------------------------------------------------*/  


      if (index % 5 == 0) {

        if (obstacle.fissureY >= window.innerHeight) {
          
            if (!executed) {
          rand = Math.floor(Math.random()*2 );
         // console.log(rand);
          obCount = parseInt(newY / window.innerHeight);
          obCount = obCount + 1;
          executed = true;        
        div = Math.floor(Math.random()*5 + obCount);
        obstacle.fissureX = (Math.random() * (window.innerWidth* 53/150 - window.innerWidth*41/75) + window.innerWidth*41/75);
        //console.log(div + 'div');
        //console.log(obCount + 'obCount');
        //console.log(obstacleA[rand].img);
      }
      }
      }
      else{
        executed =  false;
      }






        road.y = nextY;
        one.y = newY - index*window.innerHeight*2/5;
        two.y = one.y + window.innerHeight*2/5;
        three.y = one.y +window.innerHeight*4/5;
        road.backY = newY - window.innerHeight*2*(indexTwo);
        road.cityY = newY - window.innerHeight*3*(indexThree);
        obstacle.fissureY = newY - window.innerHeight * div ;
        checkpoint.y = newY - window.innerHeight*order;    



        


        if (three.y >= window.innerHeight) {
          index ++;
        }
        if (road.backY >= 0) {
          indexTwo = indexTwo + 1;
        }
        if (road.cityY >= 0) {
          indexThree = indexThree + 1;
        }
        if(index >=200) {
          index = 200;
          one.y = -window.innerHeight;
        }
        //var check = img.getBoundingClientRect();

      /*-----------------------------------------------------Obstacle Check-------------------------------------------------*/
      if (car.y < obstacle.fissureY + obstacleA[rand].h && obstacle.fissureY < car.y + car.h) {
        if (!check) {
          if (car.x + car.w > obstacle.fissureX && obstacle.fissureX + obstacleA[rand].w > car.x) {
            if (speed > 0 ) {
                speed = speed - 60;
                
              }
              if (speed <= 0) {
                speed = 0;
                check = true;
                upspeed = false;
              }
           }
       }
     }
     else{
      check = false;
     }
    /*----------------------------------------------------------------------------------------------------------------------*/
        /*--------------------------------------------Car vibrations---------------------------------------------------*/
        if (number % 2 == 0 && speed!=0 ) {
          car.x = car.x - 1/10;
          
        }
        if (number % 2 != 0 && speed!=0) {
          car.x = car.x + 1/10;
          
        }
        
        /*--------------------------------------------------------------------------------------------------------------*/
        
        //document.getElementById('disp').innerHTML = Math.floor( newY / window.innerHeight); 
        //document.getElementById("disp").innerHTML = nitro;
        // clear
        context.clearRect(0, 0, canvas.width, canvas.height);


        path();
        drawRectangle(one, two, three, context);
        sidelanes();
        
        beachBackground();
        cityBackground();
        //obSpawn( );
        obSpawn(obstacleA[rand].img, obstacleA[rand].w, obstacleA[rand].h);
        //console.log(obstacle.fissureX);
        speedometer(speed);

        drawCheckpoint();
        drawCar();
        //quizPop();
   /*------------------------------------------------Checkpoints----------------------------------------------------------*/

      if (car.y <= checkpoint.y + window.innerHeight/25 && !answer ) {
        quizPop();
        pause = true;
        speed = 0;
        questionDisp();
      }
      if (answer) {
        pause = false;
        quizTxt.style.display = 'none';
        document.getElementById('answer').style.display = 'none';
      }
      if (checkpoint.y > window.innerHeight) {
        order = order + 20;
        answer = false;
        ques = ques + 1;
      }
        // request new frame
        requestAnimFrame(function() {
          animate(one, two, three, context, startTime, speed);
        });
     
      }
    }

/*----------------------------------------------------Variables-----------------------------------------------------------------*/
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');
      context.canvas.width  = window.innerWidth;
      context.canvas.height = window.innerHeight;


      

      var one = {
        x: window.innerWidth/2,
        y: 0,
        xTwo: window.innerWidth*4/9,

        width: window.innerWidth/100,
        height: window.innerHeight/5
      };
      var two = {
        x: window.innerWidth/2,
        y: one.y + window.innerHeight*2/5,
        xTwo: window.innerWidth*4/9,

        width: window.innerWidth/100,
        height: window.innerHeight/5
      };
      var three = {
        x: window.innerWidth/2,
        y: one.y + window.innerHeight*4/5,
        xTwo: window.innerWidth*4/9,

        width: window.innerWidth/100,
        height: window.innerHeight/5
      };
      var road = {
        y: 0,
        backY: -window.innerHeight*2,
        //cityY: -window.innerHeight*2
      };
      var car = {
        x: window.innerWidth / 2.85,
        y: window.innerHeight / 1.4,
        w: window.innerWidth / 15,
        h: window.innerHeight / 4
      };
      var obstacle = {
        fissureX: window.innerWidth*53/150,
        fissureY: 0,
        fissureW: window.innerWidth/10,
        fissureH: window.innerHeight/5  

      };
      var checkpoint = {
        y: 0
      };

      var question = [
         "Which Green car is driven by Brian Griffin in the animated sitcom <q>Family Guy </q>?",
         "question 2",
         "question 3"



      ];

      

     


      var KEY = {
         LEFT:  37,
         UP:    38,
         RIGHT: 39,
         DOWN:  40,
         SPACE: 32,
         ENTER: 13
      };
      var nitroTime = 0;
      var speed = 0;
      var maxSpeed = 450;
      var prevSpeed = speed;
      var acceleration = 50;
      var decel = -50;
      var breaking = -75;
      var at = 0;
      var dt = 0;
      var dx = 0;
      var rand = 0;
      var index = 0;
      var indexTwo = 1;
      var indexThree = 1;
      var number = 0;
      var startTime;
      var upspeed;
      var downspeed;
      var left;
      var right;
      var nitro;
      var now;
      var last;
      var newY = 0;
      var speedtwo = 0;
      var pause = true;
      var nextY = 0;
      var check = false ;
      var img = document.getElementById("car");
      var stopTime = 0;
      var obCount = 1;
      var div = 2;      
      var executed = true;
      var answer = false;
      var order = 1;
      var ques = 0;
      var beachImg = document.getElementById('beach');
      var cityImg = document.getElementById('city');
      var fisImg = document.getElementById('fissure');
      var quizImg = document.getElementById('popquiz');
      var flagImg = document.getElementById('flagger');
      var quizTxt = document.getElementById('disp');
      var potImg = document.getElementById('pothole');
      var obstacleA = [];
      var pot = {
        img: potImg,
        x: window.innerWidth*53/150,
        y: 0,
        w: window.innerWidth/15,
        h: window.innerHeight/5  

      }
      var fiss = {
        img: fisImg,
        x: window.innerWidth*53/150,
        y: 0,
        w: window.innerWidth/10,
        h: window.innerHeight/5  

      }

      function heights(){
        pot.h = pot.w*potImg.height/potImg.width;
        fiss.h = fiss.w*fisImg.height/fisImg.width;
        obstacle.fissureH = obstacle.fissureW*fisImg.height/fisImg.width;
        obstacleA.push(pot);
        obstacleA.push(fiss);
        

      }
     
      


/*----------------------------------------------------Controls---------------------------------------------------------------*/
    window.addEventListener('keydown', function(event) {
      if (event.keyCode == 37) {
        left = true;
      }
      if (event.keyCode == 38) {

        upspeed = true;
        at = at + 10;
        
      }
      if (event.keyCode == 39) {
        right = true;
      }
      if (event.keyCode == 40) {
        downspeed = true;
        at = at + 10;
      }
      if (event.keyCode == 32) {
        nitro = true;
        at = at + 10;        
        
      }
      if (event.keyCode == 13) {
       answer = true;
      }
      
      
    });
    window.addEventListener('keyup', function(event) {
      if (event.keyCode == 37) {
        left = false;
      }
      if (event.keyCode == 38) {
        upspeed = false;

      }
      if (event.keyCode == 39) {
        right = false;
      }
      if (event.keyCode == 40) {
        downspeed = false;
      }
      if (event.keyCode == 32) {
        nitro = false;
      }
      at = 0;
      
     
      
    });

/*-----------------------------------------------------Minimap--------------------------------------------------------------------------------*/    
   

    var c = document.getElementById("mini");
    var ctx = c.getContext('2d');
    ctx.canvas.width  = window.innerWidth/5;
    ctx.canvas.height = window.innerWidth/5;
    var centerX = c.width / 2;
    var centerY = c.height / 2;
    var radius = c.width / 2 - 5;

      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
      ctx.fillStyle = '';
      ctx.fill();
      ctx.lineWidth = 5;
      ctx.strokeStyle = '#BF55EC';
      ctx.stroke();
      setTimeout(function() {
        last =  (new Date()).getTime();
        startTime = (new Date()).getTime();
        pause = false;
        animate(one, two, three, context, startTime,speed);
        //console.log();

      }, 100);
    </script>
  </body>
</html>      